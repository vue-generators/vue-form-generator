<template lang="jade">
	multiselect(		
		:id="selectOptions.id",
		:options="options",
		:multiple="schema.multiSelect",
		:value="value",
		:key="selectOptions.key || null",
		:label="selectOptions.label || null",
		:searchable="selectOptions.searchable",
		:local-search="selectOptions.localSearch",
		:clear-on-select="selectOptions.clearOnSelect",
		:hide-selected="selectOptions.hideSelected",
		:placeholder="schema.placeholder",
		:max-height="selectOptions.maxHeight",
		:allow-empty="selectOptions.allowEmpty",
		:reset-after="selectOptions.resetAfter",
		:close-on-select="selectOptions.closeOnSelect",
		:custom-label="customLabel",
		:taggable="selectOptions.taggable",
		:tag-placeholder="selectOptions.tagPlaceholder",
		:max="schema.max || null",
		@input="updateSelected",
		@tag="addTag",
		@select="onSelect",
		@remove="onRemove",
		@search-change="onSearchChange",
		@open="onOpen",
		@close="onClose",		
		:select-label="selectOptions.selectLabel",
		:selected-label="selectOptions.selectedLabel",
		:deselect-label="selectOptions.deselectLabel",
		:show-labels="selectOptions.showLabels",
		:limit="selectOptions.limit",
		:limit-text="selectOptions.limitText",
		:loading="selectOptions.loading",
		:disabled="disabled",
		:option-partial="selectOptions.optionPartial",
		:show-pointer="selectOptions.showPointer",
		:option-height="selectOptions.optionHeight"
	)
</template>
<script>
	import Vue from "vue";
	import abstractField from "./abstractField";

	export default {
		mixins: [abstractField],
		computed: {
			selectOptions() {
				return this.schema.selectOptions || {};
			},

			options() {
				let values = this.schema.values;
				if (typeof(values) == "function") {
					return values.apply(this, [this.model, this.schema]);
				} else {
					return values;
				}
			},
			customLabel(){
				if (typeof this.schema.selectOptions !== "undefined" && typeof this.schema.selectOptions.customLabel !== "undefined" && this.schema.selectOptions.customLabel === "function") {
					return this.schema.selectOptions.customLabel;
				} else {
					return function(currentLabel){return currentLabel;};
				} 
			}
		},
		methods: {
			updateSelected(value/*, id*/) {
				this.value = value;
			},
			addTag(newTag, id) {
				let onNewTag = this.selectOptions.onNewTag;
				if (typeof(onNewTag) == "function") {
					onNewTag(newTag, id, this.options, this.value);
				}
			},
			onSearchChange(searchQuery, id) {
				let onSearch = this.selectOptions.onSearch;
				if (typeof(onSearch) == "function") {
					onSearch(searchQuery, id, this.options);
				}
			},
			onSelect(/*selectedOption, id*/) {
				// console.log("onSelect", selectedOption, id);
			},
			onRemove(/*removedOption, id*/) {
				// console.log("onRemove", removedOption, id);
			},
			onOpen(/*id*/) {
				// console.log("onOpen", id);
			},
			onClose(/*value, id*/) {
				// console.log("onClose", value, id);
			}
		},
		created() {
			// Check if the component is loaded
			if (window.VueMultiselect) {
				Vue.component("multiselect", window.VueMultiselect.default);
			} else {
				console.error("'vue-multiselect' is missing. Please download from https://github.com/monterail/vue-multiselect and load the script in the HTML head section!");
			}
		}
	};
</script>

